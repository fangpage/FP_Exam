var getvideo, videoload = false, resultid, isvideoouts = 0, outs = 0, isNeedSkip = false; var video = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia; $(function () { $(window).scroll(function () { var g = $(window).scrollTop() >= 67, f = $(".hbx1:eq(0)"), h = f.nextAll(".hbx2,.wp"), i = f.hasClass("fixed"), k = $(".rnav"), j = window.niceback || function () { }; if (g) { if (!i) { f.addClass("fixed"); f.after("<div class='hbx1 _hbx1_'/>"); h.addClass("hbx2_f"); k.size() && k.addClass("rnavf") && $(window).resize(), j(true) } } else { i && (f.removeClass("fixed") && $("._hbx1_").remove() && h.removeClass("hbx2_f") && k.size() && k.removeClass("rnavf") && $(window).resize(), j(false)) } }); $(".rnav").size() && $(window).resize(function () { var g = $(".rnav"), f = g.hasClass("rnavf"); if (f) { g.css("right", ($("body").width() - 960) / 2 + "px") } else { g.css("right", "") } }); resultid = $("#resultid").val(); isvideo = parseInt($("#isvideo").val()); var e = parseInt($("#isexam").val()); var c = parseInt($("#autotime").val() * 60); var d = parseInt($("#examtime").val() * 60); var a = true; if (e == 1) { if (isvideo == 1) { if (!video) { $("#getphoto_state").html("当前浏览器并不支持Html5的视频API<br/>请更换能更好的支持Html5的浏览器<br/>下载：<a href='http://www.uc.cn/ucbrowser/download/' target='_blank'>UC浏览器</a>") } video.call(navigator, { video: true }, function (f) { getvideo = document.getElementById("getphoto_video"), getvideo.src = window.URL.createObjectURL(f), getvideo.onloadedmetadata = function () { videoload = true } }, function () { $("#getphoto_state").html("摄像头加载失败，请检查摄像头是否启用") }) } var b = setInterval(function () { var g = $("#thetime"), o = g.data("time"), k = (g.text() || "0:0:0").split(":"), j, n, f, l; o = (o || parseInt(k[0]) * 3600 + parseInt(k[1]) * 60 + parseInt(k[2])) - 1; n = parseInt(o / 3600); f = parseInt((o - n * 3600) / 60); l = parseInt((o - n * 3600 - f * 60) % 60); j = n.formatLen(2) + ":" + f.formatLen(2) + ":" + l.formatLen(2); g.text(j); g.data("time", o); $("#utime").val(d - o); if (isvideo == 1 && videoload && (d - o == 30 || o % 600 == 0 || o == 60)) { GetPhoto(resultid, getvideo) } if (c > 0 && (o % c == 0)) { var i = { url: "examsave.aspx", type: "POST", success: function () { } }; $("#testProcessForm").ajaxSubmit(i); return } if (d != 0 && o < 1 && a) { a = false; window.clearInterval(b); limitTimeSubmit() } }, 1000) } }); function extemporeSave() { var b = dialog1("正在保存答案…", "save"); var a = { url: "examsave.aspx", type: "POST", success: function (c) { dialog1(false, "save"); b = dialog1("保存答案成功!", "save"); setTimeout(function () { dialog1(false, "save") }, 2000) } }; $("#testProcessForm").ajaxSubmit(a); return false } function submitExam() { var a = new Popup({ contentType: 4, isReloadOnClose: false, width: 420, isAutoSize: true }); a.setContent("title", "在线考试系统"); a.setContent("alertCon", "<div class='ft8 ta_c mb10'>考试提交</div><div class='mb20 bx1 bx1_p1 ft4'>			您还有时间继续答题，确定要交卷吗？		</div><div class='ta_c ft4 mb20'><a href='#' class='btnq1' onClick='submit()'>确定交卷</a><a href='' class='btnq1 ml2 goOn'>继续答题</a></div>"); a.build(); a.show(); $("#confirmConTxt .goOn").click(function () { a.close(); return false }); $("#dialogYES").parent().remove(); setPosi("#dialogBox"); return a } function submitTest() { var a = new Popup({ contentType: 4, isReloadOnClose: false, width: 420, isAutoSize: true }); a.setContent("title", "在线考试系统"); a.setContent("alertCon", "<div class='ft8 ta_c mb10'>考试提交</div><div class='mb20 bx1 bx1_p1 ft4'>			您还有时间继续答题，确定要交卷吗？		</div><div class='ta_c ft4 mb20'><a href='#' class='btnq1' onClick='submittest()'>确定交卷</a><a href='#' class='btnq1 ml2 goOn'>继续答题</a></div>"); a.build(); a.show(); $("#confirmConTxt .goOn").click(function () { a.close(); return false }); $("#dialogYES").parent().remove(); setPosi("#dialogBox"); return a } function examOut() { var a = new Popup({ contentType: 4, isReloadOnClose: false, width: 430, isAutoSize: true }); if (isNeedSkip == false) { outs++; isNeedSkip = true } a.setContent("title", "在线考试系统"); a.setContent("alertCon", "<div class='ft8 ta_c mb10'>温馨提示：试图进行页面切换将被视为作弊行为！</div><div class='mb20 bx1 bx1_p1 ft4'>			您已切换考试页面" + outs + "次，超过5次系统将会自动交卷		</div><div class='ta_c ft4 mb20'><a id='btn_oks' href='#' class='btnq1'>确定</a></div>"); a.build(); a.show(); $("#dialogYES").parent().remove(); $("#dialogClose").remove(); setPosi("#dialogBox"); $("#btn_oks").click(function () { isNeedSkip = false; if (outs > 5) { submit() } else { a.close() } return false }); return a } function submit() { if (videoload && isvideo == 1) { GetPhoto(resultid, getvideo) } var a = $("#testProcessForm"); a.attr("action", "exampost.aspx"); a.submit() } function submittest() { var a = $("#testProcessForm"); a.attr("action", "testpost.aspx"); a.submit() } function limitTimeSubmit() { var a = new Popup({ contentType: 4, isReloadOnClose: false, width: 420, isAutoSize: true }); a.setContent("alertCon", "<div class='ft8 ta_c mb10'>考试时间已到</div><div class='mb20 bx1 bx1_p1 ft4'>					    本次考试时间已到，你可以点击 <b>确定交卷</b> 完成本次考试。<span id='subTime' class='ft2'>30</span>秒钟后，系统将自动进行本次提交。				    </div><div class='ta_c ft4 mb20'><a href='#' class='btnq1' onClick='submit()'>确定交卷</a></div>"); var c = 30; var b = setInterval(function () { c = c - 1; $("#subTime").text(c); if (c == 0 || c < 0) { window.clearInterval(b); submit() } }, 1000); a.setContent("title", "在线考试系统"); a.build(); a.show(); $("#dialogYES").parent().remove(); $("#dialogClose").remove(); setPosi("#dialogBox"); return a } function ExamReadSave() {
    var b = dialog1("正在提交阅卷…", "selfsave");
    var a = { url: "examreadpost.aspx", type: "POST", success: function (c) { dialog1(false, "selfsave"); b = dialog1("阅卷提交成功!", "selfsave2"); setTimeout(function () { dialog1(false, "selfsave2"); window.location.reload() }, 2000) }, error: function (c) { dialog1(false, "selfsave"); b = dialog1("阅卷提交失败! ", "selfsave2"); setTimeout(function () { dialog1(false, "selfsave2") }, 3000) } }; $("#testProcessForm").ajaxSubmit(a); return false
} function dialog1(c, b) { var d = dialog1[b]; if (!c) { d && d.dialog("destroy") && d.remove(); dialog1[b] = null; return } if (!d) { d = $("<div class='dialog1'>" + c + "</div>"); $("body").append(d); dialog1[b] = d } var a = $(window).scrollTop(); d.dialog({ draggable: false, closeText: "", disabled: true, title: false, minHeight: 20, minWidth: 100, position: ["center", "center"] }); $(window).scrollTop(a); return d } $(".dAn label").live("hover", function (a) { if (a.type == "mouseover") { $(this).addClass("hv") } else { $(this).removeClass("hv") } }).live("click", function () { var c = $(this).parent().find("label input"); c.parent().removeClass("sd"); c.filter(":checked").parent().addClass("sd"); var a = c.attr("id").replace("answer_", ""); var b = new Array(); $("input[id='answer_" + a + "']").each(function () { if ($(this).attr("checked")) { b.push($(this).val()) } }); if (b.length > 0) { $("#q_" + a).addClass("green_bg ") } else { $("#q_" + a).removeClass("green_bg ") } }); function setPosi(e) { var a = document.documentElement.clientWidth, c = $(e).height(), b = 0, d = document.documentElement.scrollTop || document.body.scrollTop, f = document.documentElement.clientHeight; if (window != top) { f = $(window.top).height(), d = $(window.top).scrollTop(), b = $("#" + window.name, window.top.document).offset().top } $(e).css({ "top": (f - c) / 2 + (d - b) + "px", "left": (a - $(e).width()) / 2 + "px" }) } String.prototype.copyN = function (c) { var b = ""; c = c || 1; for (var a = 0; a < c; a++) { b += this } return b }; Number.prototype.formatLen = function (c, b) { b = b || "0", c = c || 0; var a = String(this).length; if (c == 0 || a >= c) { return this + "" } else { return b.copyN(c - a) + this } };